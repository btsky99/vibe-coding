# 📄 `App.tsx` 파일 상세 문서

> **버전: v2.4.1 - [Gemini] 터미널 입력창 textarea 교체 및 엔터 처리 개선 (한글 입력 안정화, 멀티라인 지원, 엔터 즉시 전송)**
> **메인 문서:** [README.md](README.md)

- **원본 파일 경로**: `.ai_monitor/nexus-view/src/App.tsx`
- **파일 역할**: 하이브 마인드의 바이브 코딩(Vibe Coding) 프론트엔드 React 프로젝트에서 전체 대시보드 화면을 담당하는 최상위(Main) 컴포넌트입니다.

## 🛠️ 주요 기능 (Key Features)

1. **개선된 터미널 입력 바 (Terminal Input Bar) [UPDATED]**
   - **`input` → `textarea` 교체**: 한글 IME 입력 시의 불안정성을 해결하고 멀티라인 입력을 지원하기 위해 기존 단일 행 입력창을 `textarea`로 교체했습니다.
   - **엔터 키 동작 최적화**: 제미나이(Gemini) CLI 등에서 엔터 입력이 무시되거나 창이 확장되기만 하던 문제를 해결하기 위해, 엔터 키 입력 시 즉시 명령어를 전송(`\n` 포함)하도록 로직을 수정했습니다.
   - **멀티라인 지원**: `Shift + Enter`를 통해 줄바꿈이 가능하며, 입력 내용에 따라 입력창 높이가 자동으로 조절(최대 8줄)됩니다.
   - **즉시 전송**: 일반 엔터 키 입력 시 `e.preventDefault()`를 호출하여 줄바꿈 없이 즉시 `handleSend`를 실행합니다.

2. **에이전트 락(Lock) 상태 모니터링**
   - **`/api/locks` 실시간 연동**: 각 터미널 슬롯 상단 바에 현재 해당 에이전트가 점유(Lock) 중인 파일의 이름과 락 아이콘을 실시간으로 표시합니다.
   - 3초마다 백엔드에서 락 데이터를 폴링하여 에이전트 간의 작업 충돌 여부를 시각적으로 확인할 수 있게 돕습니다.

2. **8분할 확장 레이아웃 (Terminal Grid Layout) [UPDATED]**
   - 1, 2, 4(2x2), 6(3x2), **8(4x2)**의 유연한 그리드 레이아웃을 제공하여 최대 8명의 에이전트가 동시에 협업하는 환경을 모니터링할 수 있습니다.
   - 각 터미널 슬롯에서 `xterm.js`를 사용해 백엔드 파이썬 PTY 웹소켓 서버와 통신합니다.

3. **파일 탐색기 (Sidebar Explorer)**
   - `fetch('http://localhost:8000/api/files')` API를 통해 드라이브의 폴더와 파일을 불러옵니다.
   - VS Code 스타일의 동적 파일 아이콘(`getFileIcon()`)을 렌더링합니다.

4. **터미널별 활성 파일 뷰어 (Active File Viewer)**
   - 에이전트(Claude, Gemini 등)가 터미널에 남기는 출력 로그를 실시간 정규식 파싱하여, 현재 작업 중인 파일 경로를 자동 감지합니다.
   - **ANSI 이스케이프 코드 완전 제거**: CSI 시퀀스(`\x1b[...`), OSC 시퀀스(`\x1b]...`), DCS/기타 제어 시퀀스를 모두 정리한 후 파일 경로를 추출합니다.
   - 파일 경로가 감지되면, 해당 터미널 상단 1/3을 할당해 파일 내용을 보여주며 3초 단위로 백그라운드에서 내용을 새로고침합니다.

5. **단축어 매크로 시스템 및 한글 채팅 입력창**
   - 터미널 씹힘 현상을 막기 위해 한글 완벽 지원 텍스트 인풋 폼(`inputValue`)을 하단에 제공.
   - 자주 쓰는 스크립트 명령(마스터 호출, /clear, git commit 등)을 바로 전송할 수 있으며, 사용자 입맛에 맞게 단축어를 커스터마이징하고 `localStorage`에 영구 저장합니다.

6. **다중 창 기반 코드 퀵 뷰 (Multi-Window Quick View)**
   - 좌측 파일 탐색기에서 파일을 클릭하면, 자유롭게 드래그 앤 드롭이 가능하고 크기를 조정할 수 있는 `FloatingWindow` 컴포넌트가 화면에 생성됩니다.
   - 창 클릭 시 가장 맨 앞으로 당겨오는(Z-index) 기능과 함께, 상하좌우 스크롤(`min-w-max`)이 지원되는 텍스트 공간을 제공합니다.

7. **좀비 방지 하트비트 (Graceful Shutdown)**
   - `setInterval`을 이용해 5초 간격으로 서버(`api/heartbeat`)에 앱이 살아있음을 알리는 핑(Ping)을 전송하여, 창이 닫히면 서버가 알아서 종료되도록 돕습니다.
