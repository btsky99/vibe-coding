<!--
FILE: RULES.md
DESCRIPTION: 프로젝트 내 모든 에이전트가 준수해야 할 핵심 행동 수칙 및 코드 스타일 가이드

REVISION HISTORY:
- 2026-02-25 Gemini-1: 상세 주석 표준 템플릿 및 변경 이력 기록 규칙 추가
- 2026-03-01 Claude: Git 커밋 메시지 한글 상세 작성 규칙 추가 (섹션 3)
-->

# 📜 하이브 마인드 공통 행동 원칙 (Hive Mind Rules)

이 파일은 프로젝트에 참여하는 모든 AI 에이전트(Gemini, Claude 등)가 반드시 준수해야 하는 **최우선 공통 규칙**입니다.

## 🤖 1. 기본 작업 워크플로우
1. **작업 시작 전 사전 보고 의무**: 코드를 수정하거나 파일을 생성하는 등 본격적인 작업을 시작하기 전에 **반드시 어떤 문제를 해결하기 위해 어떤 파일들을 수정할 것인지 간략한 계획을 사용자에게 먼저 보고**하고 동의/승인을 구해야 합니다. (예: "~~ 기능을 구현하기 위해 A 파일과 B 파일을 수정하겠습니다. 진행할까요?")
2. **독립된 작업 공간 강제 (Git Worktrees)**: 새로운 기능 구현, 버그 수정 등 코드 변경 작업 시 메인 브랜치를 직접 수정하지 않습니다. 반드시 `using-git-worktrees` 스킬을 활성화하여 `.worktrees/` 디렉토리 하위에 격리된 워크트리를 생성하고 그 안에서 작업 및 테스트를 완료해야 합니다.
3. **하이브 동기화 (Logging & Memory Sync)**: 
   - 모든 작업의 시작과 끝에는 반드시 `scripts/hive_bridge.py`를 호출하여 다른 에이전트가 볼 수 있도록 상태 로그를 남겨야 합니다.
   - **[핵심]** 작업을 시작할 때 반드시 `python scripts/memory.py list`를 실행하여 다른 에이전트가 저장한 공유 지식(DB 스키마, 기술 결정 사항 등)을 로드하고 컨텍스트에 반영해야 합니다.
4. **상태 확인**: 작업 시작 전, 가급적 `.ai_monitor/data/task_logs.jsonl` 파일의 최근 내역을 읽어 다른 에이전트가 어떤 작업을 하고 있는지 확인하세요.
5. **마스터 지침**: 특별한 지시가 없다면 `.gemini/skills/master/SKILL.md` (또는 프로젝트 구조에 맞는 핵심 워크플로우 지침)을 기반으로 행동합니다.

## 📝 2. 한글 주석 및 중앙 프로젝트 맵 (Code-as-Doc & Project Map)
1. **코드 내 상세 주석 (Mandatory)**: 소스 코드를 수정하거나 파일을 생성할 때, **코드 내 주석은 반드시 한글로 아주 상세하게** 작성해야 합니다. 이는 배포 버전 소스 및 각종 빌드 스크립트 전반에 동일하게 적용됩니다.
   - **표준 헤더 템플릿**: 모든 파일 최상단에 아래 템플릿을 삽입하고 유지합니다.
     ```python
     """
     FILE: [파일명]
     DESCRIPTION: [파일의 역할 및 핵심 로직 설명]

     REVISION HISTORY:
     - [YYYY-MM-DD] [Agent Name]: [수정 내용 요약]
     - [예: 2026-02-25] [Gemini-1]: 주석 규칙 강화 및 에러 핸들링 로직 추가
     """
     ```
   - **언어별 주석 스타일 준수**: Python(`"""`), JS/TS(`/* ... */`), MD/HTML(`<!-- ... -->`) 등 각 언어에 맞는 주석 형식을 사용하되, 내용은 위 템플릿 형식을 따릅니다.
   - **변경 이력(History) 누적 기록**: 파일 수정 시마다 `REVISION HISTORY` 하단에 날짜, 작업자, 수정 사유(Why)를 상세히 기록합니다. (문서보다 코드 내 기록 우선)
   - **의도 중심 설계 설명**: 단순 동작 설명이 아닌 '왜(Why)' 이렇게 구현했는지에 대한 설계 의도를 상세히 기록합니다.
2. **중앙 프로젝트 맵 관리 (`PROJECT_MAP.md`)**: 개별 파일 단위의 `.md` 문서는 더 이상 생성하지 않습니다. 대신, 프로젝트 루트의 `PROJECT_MAP.md` 파일에 전체 파일 구조와 각 파일의 핵심 역할을 최신 상태로 유지해야 합니다.
3. **불필요한 문서 생성 금지**: `docs/` 폴더 내에 소스 코드와 1:1로 매칭되는 설명 문서를 생성하지 마십시오. 이는 관리 포인트 분산과 토큰 낭비를 초래합니다.
4. **.md 파일 최적화 (Token Saving)**: `PROJECT_MAP.md` 역시 너무 길어지면 토큰 낭비의 원인이 됩니다. 핵심 구조와 인터페이스 위주로 간결하게 유지하되, 전체적인 흐름을 파악할 수 있도록 작성하세요.

## 💬 3. Git 커밋 메시지 작성 규칙 (Mandatory)

모든 커밋 메시지는 **Conventional Commits 형식**을 따르되, **본문(body)은 반드시 한글로 상세하게** 작성해야 합니다.
제목(subject) 한 줄만 작성하는 것은 **금지**입니다.

### 3-1. 커밋 타입 (Type)
| 타입 | 용도 |
|------|------|
| `feat` | 새로운 기능 추가 |
| `fix` | 버그 수정 |
| `refactor` | 동작 변경 없는 코드 구조 개선 |
| `docs` | 문서·주석 변경 |
| `build` | 빌드·패키징·배포 관련 |
| `chore` | 그 외 잡무 (설정, 의존성 등) |

### 3-2. 필수 커밋 메시지 템플릿

```
<type>(<scope>): <변경 내용을 한글로 한 줄 요약 — 50자 이내>

## 변경 이유 (Why)
이 변경을 왜 해야 했는지 배경과 근본 원인을 상세히 설명합니다.
기존 코드의 어떤 문제가 있었는지, 또는 어떤 필요로 인해 추가했는지 작성하세요.

## 변경 내용 (What)
- 구체적으로 무엇을 어떻게 변경했는지 항목별로 나열합니다.
- 파일명과 함께 변경 내용을 명시합니다.
- 예: server.py — API 핸들러를 별도 모듈로 분리하여 단일 책임 원칙 적용

## 영향 범위 (Impact)
- 이 변경이 다른 기능이나 파일에 미치는 영향을 기술합니다.
- 영향 없으면 "없음 (내부 리팩토링만)" 으로 명시합니다.

Co-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>
```

### 3-3. 실제 예시

```
refactor(server): API 핸들러 도메인별 모듈 분리

## 변경 이유 (Why)
server.py 단일 파일에 모든 API 핸들러 로직이 집중되어
2000줄을 초과하였고, 도메인 간 역할 경계가 불분명해짐.
코드 탐색 및 유지보수 비용이 과도하게 높아진 상황.

## 변경 내용 (What)
- api/hive_api.py 신규 생성 — 하이브 마인드 엔드포인트 이동
- api/git_api.py 신규 생성 — Git 관련 엔드포인트 이동
- api/mcp_api.py 신규 생성 — MCP 연동 엔드포인트 이동
- api/memory_api.py 신규 생성 — 공유 메모리 엔드포인트 이동
- server.py — 각 모듈을 import하는 방식으로 대체

## 영향 범위 (Impact)
없음 — API 동작 변경 없이 파일 구조만 분리한 리팩토링.

Co-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>
```

### 3-4. 금지 사항
- ❌ 제목 한 줄만 작성 (본문 생략 불가)
- ❌ 영어로만 작성 (본문은 반드시 한글)
- ❌ "수정함", "변경함" 같은 의미 없는 본문
- ❌ `--no-verify` 로 훅 우회하여 커밋

---

## 📢 4. 작업 완료 자동 보고 의무 (Token Saving)
불필요한 대화나 장황한 설명을 생략하고 토큰 낭비를 최소화하기 위해, 단위 작업을 마칠 때마다 사용자에게 다음과 같은 **매우 간결한 리포트를 자동으로, 반드시 출력**해야 합니다.

*   **수정/생성된 파일:** (변경된 파일의 경로만 콤마로 나열)
*   **원인 (Why):** (발생했던 문제나 기능 추가의 핵심 목적을 1줄로 요약)
*   **수정 내용 (How):** (수정한 방식이나 로직을 1~2줄로 명확하게 요약)

---
> **[AI 에이전트 명심사항]**
> 사용자는 한국인이며, 모든 대답과 출력 내용은 항상 **한국어**로 작성하십시오.
> 위 규칙들은 절대적인 명령(Mandate)이며, 어떤 상황에서도 무시되어서는 안 됩니다.